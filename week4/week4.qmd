---
title: "week4"
format: html
---

```{r}
library(tidyverse)
library(spData)
library(spDataLarge)
library(sf)
library(stars)
library(terra)
```
## Load Data
```{r}
dem <- terra::rast(system.file("raster/dem.tif", package = "spDataLarge"))
landsat <- terra::rast(system.file("raster/landsat.tif", package = "spDataLarge"))
srtm <- terra::rast(system.file("raster/srtm.tif", package = "spDataLarge"))
```

## Explore data distribution
```{r}
# Create histogram of DEM
hist(dem,
     main = "Digital Elevation Model Distribution",
     xlab = "Value")
```
```{r}
# Create boxplot of DEM
boxplot(dem,
        main = "Digital Elevation Model Distribution",
        ylab = "Value")
```

## Explore elevation at Mt. Mongon, Peru
```{r}
# Reclassify dem and compute mean
rcl <- matrix(c(-Inf, 300, 1,
                300, 500, 2,
                500, Inf, 3),
              ncol = 3, byrow = TRUE)

dem_reclass <- classify(dem, rcl = rcl)

# Apply matrix to reclassify raster, making cells 1, 2, or 3
values(dem_reclass) <- as.factor(values(dem_reclass))

# Assign labels to numerical categories
levels(dem_reclass) <- tibble::tibble(id = 1:3,
                                      cats = c("low", "medium", "high"))

# Calculate mean elevation for each category- using original DEM values
elevation_mean <- zonal(dem, dem_reclass, fun = "mean") %>% 
  kable(col.names = c("Elevation Zone", "Mean elevation (m)")) %>% 
  kable_styling(bootstrap_options = "striped")
elevation_mean

# Map reclassification
map2 <- tm_shape(reclassified) +
  tm_raster(col.legend = tm_legend(title = "Elevation (m)"))+
  tm_title(text = "Mt. Mongon, Peru Elevation Classes")

map2
```
## Explore NDVI and NDWI at Zion National Park
```{r}
# Apply scale factor and offset for all Landsat grid cells
scale_factor <- 0.0000275
offset <- -0.2

scale_function <- function(x) {
  x * scale_factor + offset
}

landsat_scaled <- app(landsat, fun = scale_function)
```

```{r}
# Calculate NDVI 
ndvi_function <- function(nir, red) {
  (nir - red) / (nir + red)
}

#zion_ndvi <- app(landsat, fun = ndvi_function)
```

